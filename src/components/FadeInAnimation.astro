---
// 渐显动画组件
// 为页面元素添加渐显过渡效果
interface Props {
	selector?: string; // 选择器，默认为 '.post-content'
	elements?: string; // 要添加动画的元素选择器
	includeCards?: boolean; // 是否包含卡片元素
	includeShuoshuo?: boolean; // 是否包含说说列表
}

const { 
	selector = '.post-content',
	elements = 'p, h1, h2, h3, h4, h5, h6, ul, ol, blockquote, pre, table, hr',
	includeCards = false,
	includeShuoshuo = false
} = Astro.props;
---

<script is:inline define:vars={{ selector, elements, includeCards, includeShuoshuo }}>
	// 为页面内容添加渐显动画
	function addFadeInAnimation() {
		let currentIndex = 0;

		// 为主内容区添加动画
		const container = document.querySelector(selector);
		if (container) {
			const contentElements = container.querySelectorAll(elements);
			const visibleElements = Array.from(contentElements).filter(el => el.offsetParent !== null);
			
			visibleElements.forEach((el, index) => {
				el.style.opacity = '0';
				setTimeout(() => {
					el.classList.add('fadeInUp');
					el.style.animationDelay = `${index * 0.05}s`;
				}, 10);
			});
			
			currentIndex = visibleElements.length;
		}

		// 为项目卡片添加动画
		if (includeCards) {
			const projectCards = document.querySelectorAll('.projects-container .card');
			projectCards.forEach((card, index) => {
				card.style.opacity = '0';
				setTimeout(() => {
					card.classList.add('fadeInUp');
					card.style.animationDelay = `${index * 0.05}s`;
				}, 10);
			});
		}

		// 为说说列表添加动画
		if (includeShuoshuo) {
			const shuoshuoItems = document.querySelectorAll('#shuoshuo li.comment');
			shuoshuoItems.forEach((item, index) => {
				item.style.opacity = '0';
				setTimeout(() => {
					item.classList.add('fadeInUp');
					item.style.animationDelay = `${(currentIndex + index) * 0.05}s`;
				}, 10);
			});
		}

		// 为列表页添加动画
		const listItems = document.querySelectorAll('.posts li');
		if (listItems.length > 0) {
			listItems.forEach((item, index) => {
				item.style.opacity = '0';
				setTimeout(() => {
					item.classList.add('fadeInUp');
					item.style.animationDelay = `${index * 0.05}s`;
				}, 10);
			});
		}
	}

	// 页面加载时初始化
	document.addEventListener('DOMContentLoaded', addFadeInAnimation);
	// 支持 Astro View Transitions
	document.addEventListener('astro:page-load', addFadeInAnimation);
</script>
