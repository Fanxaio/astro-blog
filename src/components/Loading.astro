---
// Loading component for initial page load - only on homepage
interface Props {
	showOnHomepage?: boolean;
}

const { showOnHomepage = false } = Astro.props;
---

{
	showOnHomepage && (
		<div
			id='loading-overlay'
			class='loading-overlay'>
			<div class='loading-spinner'>
				<div class='spinner' />
				<p class='loading-text'>加载中...</p>
			</div>
		</div>
	)
}

<style>
	.loading-overlay {
		position: fixed;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		background-color: var(--background-color);
		display: flex;
		justify-content: center;
		align-items: center;
		z-index: 9999;
		opacity: 1;
		transition: opacity 0.3s ease-out;
	}

	.loading-overlay.hidden {
		opacity: 0;
		pointer-events: none;
	}

	.loading-spinner {
		text-align: center;
	}

	.spinner {
		width: 40px;
		height: 40px;
		border: 3px solid var(--gray-color);
		border-top: 3px solid var(--link-color);
		border-radius: 50%;
		animation: spin 1s linear infinite;
		margin: 0 auto 1rem;
	}

	.loading-text {
		color: var(--text-color);
		font-size: 0.9rem;
		margin: 0;
	}

	@keyframes spin {
		0% {
			transform: rotate(0deg);
		}
		100% {
			transform: rotate(360deg);
		}
	}
</style>

<script>
	// 隐藏页面加载覆盖层（当页面完全加载时）
	if (document.readyState === 'loading') {
		document.addEventListener('DOMContentLoaded', () => {
			setTimeout(() => {
				const overlay = document.getElementById('loading-overlay');
				if (overlay) {
					overlay.classList.add('hidden');
					// 动画完成后从DOM中删除
					setTimeout(() => overlay.remove(), 300);
				}
			}, 300); // 略有延时候保顺利过渡
		});
	} else {
		// 如果DOM已经加载，立即隐藏
		const overlay = document.getElementById('loading-overlay');
		if (overlay) {
			overlay.classList.add('hidden');
			setTimeout(() => overlay.remove(), 300);
		}
	}
</script>
